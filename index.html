<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="en-US">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.2" />






<meta name="description" content="personal blog">
<meta property="og:type" content="website">
<meta property="og:title" content="manuscrit">
<meta property="og:url" content="http://YolandaWEI.github.io/index.html">
<meta property="og:site_name" content="manuscrit">
<meta property="og:description" content="personal blog">
<meta property="og:locale" content="en-US">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="manuscrit">
<meta name="twitter:description" content="personal blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://YolandaWEI.github.io/"/>





  <title>manuscrit</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en-US">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">manuscrit</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://YolandaWEI.github.io/2018/10/07/Event-drive-Asynochronous-Programming/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="YolandaWEI">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="manuscrit">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/10/07/Event-drive-Asynochronous-Programming/" itemprop="url">Event-drive Asynochronous Programming</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-10-07T00:16:03+02:00">
                2018-10-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/uncategories/Event-drive-Asynochronous-Programming/" itemprop="url" rel="index">
                    <span itemprop="name">Event-drive Asynochronous Programming</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Syntax"><a href="#Syntax" class="headerlink" title="Syntax"></a>Syntax</h1><h2 id="Declaration-var-const-let"><a href="#Declaration-var-const-let" class="headerlink" title="Declaration: var\const\let"></a>Declaration: var\const\let</h2><p>Only use let except you know it would never change.<br>A variable declared with <code>var</code> whose scope is within the function in which the statement is located, and there is a variable promotion phenomenon;<br>A variable declared with <code>let</code> whose scope is within the code block in which the statement is located, and there is no variable promotion;<br>The use of const declares a <code>const</code>, and the value of the constant cannot be modified in the code that appears later.</p>
<h2 id="c-f"><a href="#c-f" class="headerlink" title="=== c.f. =="></a>=== c.f. ==</h2><p>Always use=== unless you have specially reason to use ==, it.<br>=== will check both value and type.</p>
<blockquote>
<p><a href="https://www.zhihu.com/question/31442029" target="_blank" rel="noopener">from Zhihu@Belleve</a><br>Red：===<br>Orange：==<br>Yellow：&lt;= and &gt;= established，== not established<br>Blue：only &gt;= established<br>Green：only &lt;= established<br><img src="https://pic3.zhimg.com/80/b922270259dece707ef6c6a50259a406_hd.png" alt="===and== from Zhihu@Belleve"></p>
</blockquote>
<h2 id="Template-String-var"><a href="#Template-String-var" class="headerlink" title="Template String ${var}"></a>Template String ${var}</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> firstName = <span class="string">'Jake'</span>;</span><br><span class="line"><span class="keyword">var</span> lastName = <span class="string">'Rawr'</span>;</span><br><span class="line"><span class="comment">//normal String</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'My name is '</span> + firstName + <span class="string">' '</span> + lastName);</span><br><span class="line"><span class="comment">//Template String</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">`My name is <span class="subst">$&#123;firstName&#125;</span> <span class="subst">$&#123;lastName&#125;</span>`</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Fuctions-and-arrow-funcitons"><a href="#Fuctions-and-arrow-funcitons" class="headerlink" title="Fuctions and arrow funcitons"></a>Fuctions and arrow funcitons</h2><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fuction inc1=<span class="number">1</span>(n)&#123;</span><br><span class="line"><span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> inc2=<span class="function"><span class="keyword">function</span>(<span class="params">n</span>)</span>&#123;<span class="keyword">return</span> n+<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">const</span> inc3=<span class="function">(<span class="params">n</span>)=&gt;</span>&#123;<span class="keyword">return</span> n+<span class="number">1</span>&#125;</span><br><span class="line"><span class="keyword">const</span> inc4=<span class="function"><span class="params">n</span>=&gt;</span>n+<span class="number">4</span></span><br><span class="line"><span class="comment">//they are all same.</span></span><br><span class="line"></span><br><span class="line">fucntion adder(inc) &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="function">(<span class="params">n</span>)=&gt;</span>n+inc</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> addOne=adder(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> addTwo=adder(<span class="number">2</span>)</span><br><span class="line"><span class="keyword">let</span> a=addOne(<span class="number">5</span>)<span class="comment">//a=6</span></span><br><span class="line"><span class="keyword">let</span> b=addTwo(<span class="number">5</span>)<span class="comment">//b=7</span></span><br><span class="line"><span class="keyword">let</span> c=adder(<span class="number">2</span>)(<span class="number">1</span>)<span class="comment">//c=3 </span></span><br><span class="line"><span class="comment">//use pointers to point the functions' addres .</span></span><br></pre></td></tr></table></figure>
<h2 id="JavaScript-Scope-（作用域）-Fuction-level"><a href="#JavaScript-Scope-（作用域）-Fuction-level" class="headerlink" title="JavaScript Scope （作用域）: Fuction-level"></a>JavaScript Scope （作用域）: Fuction-level</h2><p>In JS there are two types of scope: Local scope and Global scope<br><strong>JavaScript has function scope: Each function creates a new scope.</strong> The traditional C-like language, whose scope is block-level scope, curly brackets<code>{}</code> are a scope. But for JavaScript, its scope is a function-level scope, such as an <code>if</code> conditional statement, which is not an independent scope:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(x); <span class="comment">// 2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//Create a temporary scope from a self-executing function</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">if</span> (x) &#123;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> x = <span class="number">2</span>;</span><br><span class="line"><span class="comment">// some other code</span></span><br><span class="line">&#125;());</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// x is still 1.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Event-drive-and-Asynchronous"><a href="#Event-drive-and-Asynchronous" class="headerlink" title="Event-drive and Asynchronous"></a>Event-drive and Asynchronous</h2><p>There is only one main thread in JS engine. When it is executing JS code block, other code block are not allowed to be executed, but the code block of event machine and callback will be added into task queue (or called stack).This event or callback function will be executed when a trigger meet the event or callback.</p>
<h3 id="Callbacks"><a href="#Callbacks" class="headerlink" title="Callbacks"></a>Callbacks</h3><p>callbacks are historically the only way to deal with functions that return a result asynchronously.</p>
<h3 id="Promise"><a href="#Promise" class="headerlink" title="Promise"></a><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise" target="_blank" rel="noopener">Promise</a></h3><p>A Promise is in one of these states:</p>
<ul>
<li>pending: initial state, neither fulfilled nor rejected.</li>
<li>fulfilled: meaning that the operation completed successfully.</li>
<li>rejected: meaning that the operation failed.<br><img src="https://mdn.mozillademos.org/files/15911/promises.png" alt="Promise state"></li>
</ul>
<h1 id="TP1-Mandelbrot-set-Initial-image-of-a-zoom-sequence"><a href="#TP1-Mandelbrot-set-Initial-image-of-a-zoom-sequence" class="headerlink" title="TP1 Mandelbrot set. Initial image of a zoom sequence"></a>TP1 Mandelbrot set. Initial image of a zoom sequence</h1><p>##Prepare your project Node.js<br>Install node from the official website: <a href="https://nodejs.org" target="_blank" rel="noopener">https://nodejs.org</a>.<br>Create a new folder and add an app.js script, whose contents are as follows:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.log(<span class="string">"Hello World"</span>)</span><br></pre></td></tr></table></figure></p>
<p>Open a new terminal and locate it in your project folder.<br>Launch your application with the command:</p>
<p>node app.js</p>
<p>We will configure the project in npm, thanks to the command <code>npm init</code>. You will answer the different questions.</p>
<p>##Complex numbers<br>We will create a small class to encapsulate and manipulate complex numbers, which will meet the needs of the TP suite.</p>
<p>Resume and complete the following Complex class. None of the methods of the Complex class should alter the fields <code>this.re</code> and <code>this.im</code>. Complex objects that they return are therefore always new instances.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Complex</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span> (re, im) &#123;</span><br><span class="line"><span class="keyword">this</span>.re = re</span><br><span class="line"><span class="keyword">this</span>.im = im</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @return Complex le carré du complexe this</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">square () &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @param &#123;Complex&#125; second à sommer à this</span></span><br><span class="line"><span class="comment">* @return Complex la somme this + second</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sum (second) &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">* @return Number le module du complexe this</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span> () &#123; <span class="comment">/*...*/</span> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To test that the library works:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> c1 = <span class="keyword">new</span> Complex(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"|c1| = "</span> + c1.module())</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c1 * c1 = "</span> + <span class="built_in">JSON</span>.stringify(c1.square()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c2 = <span class="keyword">new</span> Complex(<span class="number">1</span>, <span class="number">0</span>)</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"c1 + c2 = "</span> + <span class="built_in">JSON</span>.stringify(c1.sum(c2)))</span><br></pre></td></tr></table></figure></p>
<p>What should display at runtime:</p>
<p>|c1| = 1<br>c1 * c1 = {“re”:-1,”im”:0}<br>c1 + c2 = {“re”:1,”im”:1}</p>
<h3 id="Notes-Complex-operation"><a href="#Notes-Complex-operation" class="headerlink" title="Notes: Complex operation"></a>Notes: Complex operation</h3><blockquote>
<p>A complex number is a number that can be expressed in the form $ z = x + iy $, where $ x $ and $ y $ are real numbers, and $ i $ is a solution of the equation $ x^2 = −1 $. It can also be expressed in polar form as $ z=re^{i\varphi} $.</p>
</blockquote>
<ul>
<li>The sum<br>$ z_1+z_2=(x_1+x_2)+i(y_1+y_2) $</li>
</ul>
<p><img src="https://wx1.sinaimg.cn/mw690/eb01748fgy1fvrwm4us3gj208c0bqgln.jpg" alt="$ z = x + iy $ and $ z=re^{i\varphi} $"> </p>
<ul>
<li>The module<br>In this way, $ r=|z| $, and $ x=rcos\varphi $, $ y=rsin\varphi $.<br>So we can get $ |z|=\sqrt{x^2+y^2} $</li>
<li>The square<br>$ z^2=(x+iy)^2=x^2+i2xy+(iy)^2=(x^2-y^2)+i2xy $</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Complex numbers</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Complex</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">constructor</span>(re, im) &#123;</span><br><span class="line"><span class="keyword">this</span>.re = re</span><br><span class="line"><span class="keyword">this</span>.im = im</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*get the square of this complex number</span></span><br><span class="line"><span class="comment">* @method square()</span></span><br><span class="line"><span class="comment">* @return &#123;Complex&#125; the square of this complex</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">square() &#123;</span><br><span class="line"><span class="keyword">var</span> squ=<span class="keyword">new</span> Complex()</span><br><span class="line">squ.re= <span class="keyword">this</span>.re * <span class="keyword">this</span>.re - <span class="keyword">this</span>.im * <span class="keyword">this</span>.im</span><br><span class="line">squ.im = <span class="number">2</span> * <span class="keyword">this</span>.re * <span class="keyword">this</span>.im</span><br><span class="line"><span class="keyword">return</span> squ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*get the sum of this complex number and the second one</span></span><br><span class="line"><span class="comment">* @method sum(second)</span></span><br><span class="line"><span class="comment">* @param second&#123;Complex&#125;  to summon this</span></span><br><span class="line"><span class="comment">* @return &#123;Complex&#125; the sum this + second</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">sum(second) &#123;</span><br><span class="line"><span class="keyword">var</span> summ=<span class="keyword">new</span> Complex()</span><br><span class="line">summ.re = <span class="keyword">this</span>.re + second.re</span><br><span class="line">summ.im = <span class="keyword">this</span>.im + second.im</span><br><span class="line"><span class="keyword">return</span> summ</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*get the module of this complex</span></span><br><span class="line"><span class="comment">* @method module()</span></span><br><span class="line"><span class="comment">* @return &#123;Number&#125; the module of this complex</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="built_in">module</span>() &#123;</span><br><span class="line"><span class="keyword">var</span> <span class="built_in">Number</span> = <span class="built_in">Math</span>.sqrt(<span class="keyword">this</span>.im * <span class="keyword">this</span>.im + <span class="keyword">this</span>.re * <span class="keyword">this</span>.re)</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Number</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>##Read a number from the console<br>The <a href="https://blog.csdn.net/chy555chy/article/details/52626404" target="_blank" rel="noopener">readline module</a> (integrated with node) is used to manipulate flows, read one line at a time. Among these flows, one can access those of the console (process.stdin, process.stdout). Here is what the official documentation gives us:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">input: process.stdin,</span><br><span class="line">output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">rl.question(<span class="string">'What do you think of Node.js? '</span>, (answer) =&gt; &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Log the answer in a database</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Thank you for your valuable feedback:'</span>, answer)</span><br><span class="line"></span><br><span class="line">rl.close()</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//https://nodejs.org/api/readline.html#readline_readline</span></span><br></pre></td></tr></table></figure></p>
<p>To convert a string to a number: <code>parseInt (string) or Number (string)</code><br>Design a program with the following behavior (question + confirmation):</p>
<p>Size of the image to generate? 128<br>Choice of dimensions: 128x128px</p>
<h3 id="Notes-JS-readline-Interface-module"><a href="#Notes-JS-readline-Interface-module" class="headerlink" title="Notes: JS readline.Interface module"></a>Notes: JS readline.Interface module</h3><ul>
<li>When the code is called, the Node.js program does not terminate until <code>readline.Interface</code> is closed because the interface is waiting for data to be received in the <code>input</code> stream.</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">input: process.stdin,</span><br><span class="line">output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">rl.question(<span class="string">'Size of the image to generate? '</span>, (size) =&gt; &#123;</span><br><span class="line"><span class="comment">// <span class="doctag">TODO:</span> Log the answer in a database</span></span><br><span class="line"><span class="keyword">var</span> imsize = size + <span class="string">" x "</span> + size + <span class="string">" px"</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Choice of dimensions:'</span>, imsize)</span><br><span class="line">rl.close()</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Compare <a href="https://www.cnblogs.com/libin-1/p/7127481.html" target="_blank" rel="noopener">require/import/export in JS</a> </p>
<blockquote>
<p>CommonJS &amp; AMD use require to use module</p>
</blockquote>
<h3 id="Notes-Asyn-event"><a href="#Notes-Asyn-event" class="headerlink" title="Notes: Asyn event"></a>Notes: Asyn event</h3><ul>
<li>the second question on console <figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">input: process.stdin,</span><br><span class="line">output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> question1 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">rl.question(<span class="string">'Size of the image to generate? '</span>, (size) =&gt; &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//input control</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="regexp">/^\d+$/</span>.test(size)) &amp;&amp; (size &gt; <span class="number">0</span>) &amp;&amp; (size &lt;= <span class="number">1080</span>)) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Choice of dimensions:'</span> + size + <span class="string">" x "</span> + size + <span class="string">" px"</span>)</span><br><span class="line"><span class="comment">//size&#123;String&#125; are all numbers and size is in [1,1080] integer</span></span><br><span class="line"><span class="keyword">return</span> resolve(size)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">resolve(question1())</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> question2 = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">rl.question(<span class="string">'Image Name? '</span>, (name) =&gt; &#123;</span><br><span class="line"><span class="built_in">console</span>.log(name+<span class="string">".png on DESKTOP"</span>)</span><br><span class="line"><span class="keyword">return</span> resolve(name)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> main = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">var</span> size = <span class="keyword">await</span> question1()</span><br><span class="line"><span class="keyword">var</span> name = <span class="keyword">await</span> question2()</span><br><span class="line"><span class="built_in">console</span>.log(name+<span class="string">".png: "</span>+size+<span class="string">" x "</span>+size+<span class="string">" px"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//rl.close()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Generate-a-random-image"><a href="#Generate-a-random-image" class="headerlink" title="Generate a random image"></a>Generate a random image</h2><p>Thanks to the jimp library, we will be able to create and save images. The dimension will be requested thanks to the previous question.</p>
<p>To install jimp: npm install jimp –save. The dependency is installed and referenced in package.json.</p>
<p>Here are some excerpts from the documentation to manipulate the library:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Jimp = <span class="built_in">require</span>(<span class="string">"jimp"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// open a file called "lenna.png"</span></span><br><span class="line">Jimp.read(<span class="string">"lenna.png"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err, image</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (err) <span class="keyword">throw</span> err</span><br><span class="line">image.write(<span class="string">"lena-small-bw.jpg"</span>) <span class="comment">// save</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Jimp(<span class="number">256</span>, <span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">image.getPixelColor(x, y) <span class="comment">// colour of that pixel e.g. 0xFFFFFFFF</span></span><br><span class="line">image.setPixelColor(hex, x, y) <span class="comment">// sets the colour of that pixel</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// e.g. converts 255, 255, 255, 255 to 0xFFFFFFFF </span></span><br><span class="line">Jimp.rgbaToInt(r, g, b, a)</span><br><span class="line"></span><br><span class="line"><span class="comment">// e.g. converts 0xFFFFFFFF to &#123;r: 255, g: 255, b: 255, a:255&#125; </span></span><br><span class="line">Jimp.intToRGBA(hex)</span><br><span class="line"></span><br><span class="line"><span class="comment">//https://www.npmjs.com/package/jimp</span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>Pixels have 4 components (red, green, blue and alpha). Alpha at 255 equals a fully opaque color, 0 at a transparent color.</li>
<li>Alpha is of low weight in hexadecimal writing.</li>
<li>The Math.random() function returns a pseudo random number between 0 and 1 excluded.</li>
</ul>
<p>Design a <code>getRandomPixel()</code> function that returns a hexadecimal color at random, but with an alpha component = 255.</p>
<p>Design the <code>buildRandomImage (size, name)</code> function that takes parameters in pixels and the name to save the image to disk. You will call this function inside the callback passed to <code>readline.question(cb)</code>.</p>
<div style="text-align:center;"><img src="https://wx4.sinaimg.cn/mw690/eb01748fgy1fvrxnqcrqaj205805840z.jpg"></div>

<p>After running your program, you should get an image similar to the example shown here (size: 128px).</p>
<h3 id="Notes"><a href="#Notes" class="headerlink" title="Notes:"></a>Notes:</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="comment">/* get a random int number in [minNum,maxNum] in hexadecimal String</span></span><br><span class="line"><span class="comment">* @method randomNum()</span></span><br><span class="line"><span class="comment">* @param minNum&#123;Integer&#125;</span></span><br><span class="line"><span class="comment">* @param maxNum&#123;Integer&#125;</span></span><br><span class="line"><span class="comment">* @return &#123;String&#125; (hexadecimal)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randomNum</span>(<span class="params">minNum, maxNum</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> num = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * (maxNum - minNum + <span class="number">1</span>) + minNum, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">16</span>) &#123;</span><br><span class="line"><span class="comment">//if the number is just in one bit, add a 0 in high-order position ("e"-&gt;"0e")</span></span><br><span class="line">num = <span class="string">'0'</span> + num.toString(<span class="number">16</span>) </span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">num=num.toString(<span class="number">16</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> num; </span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* get a random rgb pixel color with 255 alpha </span></span><br><span class="line"><span class="comment">* @method getRandomPixel()</span></span><br><span class="line"><span class="comment">* @return &#123;String&#125; (hexadecimal and start with '0x')</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomPixel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> R = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">var</span> G = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">var</span> B = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">'0x'</span>+R+G+B+<span class="string">'ff'</span> <span class="comment">//with 255 alpha</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* get a random picture in size x size px with 255 alpha RGBA PNG on DeskTop</span></span><br><span class="line"><span class="comment">* @method buildRandomPixel()</span></span><br><span class="line"><span class="comment">* @param size</span></span><br><span class="line"><span class="comment">* @param name image name(without)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildRandomImage</span>(<span class="params">size, name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> DESKTOP_URL = <span class="string">"C:\\Users\\YolandaW\\Desktop\\"</span></span><br><span class="line"><span class="comment">//Generate a random image</span></span><br><span class="line"><span class="keyword">const</span> Jimp = <span class="built_in">require</span>(<span class="string">"jimp"</span>)</span><br><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Jimp(size, size) </span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; size ; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> ( j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">image.setPixelColor(<span class="built_in">parseInt</span>(getRandomPixel()), i, j) <span class="comment">// sets the colour of that pixel</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">name = name + <span class="string">".png"</span> <span class="comment">//save on Desktop</span></span><br><span class="line">image.write(DESKTOP_URL+name) <span class="comment">//save image  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">buildRandomImage(<span class="number">256</span>, <span class="string">"image"</span>)</span><br></pre></td></tr></table></figure>
<p>After combine two question together</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">'use strict'</span></span><br><span class="line"><span class="keyword">const</span> readline = <span class="built_in">require</span>(<span class="string">'readline'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> rl = readline.createInterface(&#123;</span><br><span class="line">input: process.stdin,</span><br><span class="line">output: process.stdout</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> askImageSize = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">rl.question(<span class="string">'Size of the image to generate? '</span>, (size) =&gt; &#123;</span><br><span class="line"><span class="comment">//input control</span></span><br><span class="line"><span class="keyword">if</span> ((<span class="regexp">/^\d+$/</span>.test(size)) &amp;&amp; (size &gt; <span class="number">0</span>) &amp;&amp; (size &lt;= <span class="number">1080</span>)) &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'Choice of dimensions:'</span> + size + <span class="string">" x "</span> + size + <span class="string">" px"</span>)</span><br><span class="line"><span class="comment">//size&#123;String&#125; are all numbers and size is in [1,1080] integer</span></span><br><span class="line"><span class="keyword">return</span> resolve(size)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">resolve(askImageSize())</span><br><span class="line">&#125;</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> askImageName = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">rl.question(<span class="string">'Image Name? '</span>, (name) =&gt; &#123;</span><br><span class="line"><span class="built_in">console</span>.log(name+<span class="string">".png on DESKTOP"</span>)</span><br><span class="line"><span class="keyword">return</span> resolve(name)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* get a random int number in [minNum,maxNum] in hexadecimal String</span></span><br><span class="line"><span class="comment">* @method randomNum()</span></span><br><span class="line"><span class="comment">* @param minNum&#123;Integer&#125;</span></span><br><span class="line"><span class="comment">* @param maxNum&#123;Integer&#125;</span></span><br><span class="line"><span class="comment">* @return &#123;String&#125; (hexadecimal)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">randomNum</span>(<span class="params">minNum, maxNum</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> num = <span class="built_in">parseInt</span>(<span class="built_in">Math</span>.random() * (maxNum - minNum + <span class="number">1</span>) + minNum, <span class="number">10</span>)</span><br><span class="line"><span class="keyword">if</span> (num &lt; <span class="number">16</span>) &#123;</span><br><span class="line"><span class="comment">//if the number is just in one bit, add a 0 in high-order position ("e"-&gt;"0e")</span></span><br><span class="line">num = <span class="string">'0'</span> + num.toString(<span class="number">16</span>)</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">num = num.toString(<span class="number">16</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* get a random rgb pixel color with 255 alpha </span></span><br><span class="line"><span class="comment">* @method getRandomPixel()</span></span><br><span class="line"><span class="comment">* @return &#123;String&#125; (hexadecimal and start with '0x')</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getRandomPixel</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> R = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">var</span> G = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">var</span> B = randomNum(<span class="number">0</span>, <span class="number">255</span>)</span><br><span class="line"><span class="keyword">return</span> <span class="string">'0x'</span> + R + G + B + <span class="string">'ff'</span> <span class="comment">//with 255 alpha</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* get a random picture in size x size px with 255 alpha RGBA PNG on DeskTop</span></span><br><span class="line"><span class="comment">* @method buildRandomPixel()</span></span><br><span class="line"><span class="comment">* @param size</span></span><br><span class="line"><span class="comment">* @param name image name(without)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildRandomImage</span>(<span class="params">size, name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">const</span> DESKTOP_URL = <span class="string">"C:\\Users\\YolandaW\\Desktop\\"</span></span><br><span class="line"><span class="comment">//Generate a random image</span></span><br><span class="line"><span class="keyword">const</span> Jimp = <span class="built_in">require</span>(<span class="string">"jimp"</span>)</span><br><span class="line"><span class="keyword">var</span> image = <span class="keyword">new</span> Jimp(size, size)</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> j = <span class="number">0</span>; j &lt; size; j++) &#123;</span><br><span class="line">image.setPixelColor(<span class="built_in">parseInt</span>(getRandomPixel()), i, j) <span class="comment">// sets the colour of that pixel</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">name = name + <span class="string">".png"</span> <span class="comment">//save on Desktop</span></span><br><span class="line">image.write(DESKTOP_URL + name) <span class="comment">//save image  </span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> main = <span class="keyword">async</span> () =&gt; &#123;</span><br><span class="line"><span class="keyword">var</span> size = <span class="keyword">await</span> askImageSize()</span><br><span class="line"><span class="keyword">var</span> name = <span class="keyword">await</span> askImageName()</span><br><span class="line">buildRandomImage(size, name)</span><br><span class="line"><span class="built_in">console</span>.log(name + <span class="string">".png: "</span> + size + <span class="string">" x "</span> + size + <span class="string">" px has been created on DESKTOP"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">//rl.close()</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>
<h3 id="Notes-different-image-form-PNG、JP"><a href="#Notes-different-image-form-PNG、JP" class="headerlink" title="Notes: different image form PNG、JP"></a>Notes: different image form PNG、JP</h3><h3 id="Notes-read-write-image"><a href="#Notes-read-write-image" class="headerlink" title="Notes: read/write image"></a>Notes: read/write image</h3><h3 id="Notes-JS-comments-and-How-to-name-method"><a href="#Notes-JS-comments-and-How-to-name-method" class="headerlink" title="Notes: JS comments and How to name method"></a>Notes: JS comments and How to name method</h3><h2 id="A-fractal-in-shades-of-gray"><a href="#A-fractal-in-shades-of-gray" class="headerlink" title="A fractal in shades of gray"></a>A fractal in shades of gray</h2><p>The sought-after fractal is Mandelbrot’s fractal. The color of each pixel is calculated as a function of the divergence rate of a complex recursive sequence.</p>
<p>For each pixel, we set a number $ C = x + iy $, with x and y the coordinates of the standardized pixel between 0 and 1. To normalize, divide the usual coordinates by the size of each dimension.</p>
<p>The recurrence formula is: $ Z_n = (Z_{n-1})^2 + C $</p>
<ul>
<li>$ Z_n $ is a rank n term of a complex suite</li>
<li>$ Z_0  = 0 + i0 = 0 $</li>
<li>$ C  $ is a complex constant, added to each recursion and linked to the pixel</li>
</ul>
<p>We consider that the series diverges as soon as the modulus of a term exceeds 2. When a divergence is detected, we return n, the rank from which $ | Z_n | &gt; 2 $. We calculate at most 20 terms: beyond, we suppose that the sequence converges and we return 20.</p>
<p>We give the algorithm in algorithmic language. Translate it as a function <code>getMandelbrotDivergenceSpeed (Complex): Number</code>.</p>
<table><br><tr><br><th colspan="2">SpeedDevergence (c: Complex): integer</th><br></tr><br><tr><br><th>Data:</th><br><td>c: Complex, the coordinates of a pixel such as $(c.re, c.im)$ $E [0,1] ^2$</td><br></tr><br><tr><br><th>Local variable:</th><br><td>z: Complex, the term of the sequence $Z$ at rank $n$</td><br></tr><br><tr><br><th>Local variable:</th><br><td>n: integer the currently calculated rank </td><br></tr><br><tr><br><th>Result:</th><br><td>Returns the rank $[0, 19]$ from which the divergence is found or $20$ otherwise</td><br></tr><br></table>

<p>beginning</p>
<ul>
<li>$z ← Complex (0, 0)$</li>
<li>$n ← 0$</li>
<li>as long as $n &lt;20 $ repeat </li>
<li>$z ← z * z + c$</li>
<li>if $ z.module ()&gt; 2 $ then return $ n $</li>
<li>$n ← n + 1$</li>
<li>end as long as</li>
<li>return $20$</li>
</ul>
<p>end</p>
<p>Design a function <code>coordToComplex (x, y, size): Complex</code> Very simple that accepts two coordinates (x, y) as well as the size of the image and returns a complex c such that:</p>
<ul>
<li>c.re be x normalized between 0 and 1</li>
<li>c.im is normalized between 0 and 1</li>
</ul>
<p>Design a <code>speedToGrey (n): Number</code> function that takes a divergence rate parameter and returns a fully opaque gray hue in hexadecimal such as:</p>
<ul>
<li>n = 0 returns white.</li>
<li>n = 20 returns black.</li>
</ul>
<p>Design a <code>buildGreyFractal (size, name)</code> function that takes parameters in pixels and the name to save the image to disk.</p>
<p>##See the entire fractal<br>Currently, you only see a quarter of the fractal. Why? Because we associate with our pixel coordinates strictly positive values.</p>
<p>For example, on an image of 128x128px:</p>
<ul>
<li>currently</li>
<li>the pixel (0,0) is transformed into Complex (0, 0)</li>
<li>the pixel (128, 128) is transformed into Complex (1, 1)</li>
<li>in the version that you will improve</li>
<li>the pixel (0, 0) is transformed into Complex (-1, -1)</li>
<li>the pixel (64, 64) is transformed into Complex (0, 0)</li>
<li>the pixel (128, 128) is transformed into Complex (1, 1)</li>
<li>Get such behavior only changing the function coordToComplex (x, y, size).</li>
</ul>
<h2 id="Go-further-on-the-manipulation-of-coordinates"><a href="#Go-further-on-the-manipulation-of-coordinates" class="headerlink" title="Go further on the manipulation of coordinates"></a>Go further on the manipulation of coordinates</h2><p>If you still have time at the end of the session, you can tackle the following issues:</p>
<ul>
<li>choose the zoom to apply</li>
<li>choose a translation to apply</li>
<li>choose a rotation to apply</li>
<li>choose a stretch on each of the dimensions</li>
</ul>
<h2 id="A-fractal-in-color"><a href="#A-fractal-in-color" class="headerlink" title="A fractal in color"></a>A fractal in color</h2><p>To enjoy your fractal in color, you can use the following function<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">speedToColor</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">n = <span class="built_in">Math</span>.min(n / <span class="number">50</span>, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">let</span> s = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> l = <span class="number">0.6</span>, r, g, b</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (s === <span class="number">0</span>) &#123;</span><br><span class="line">r = g = b = l <span class="comment">// achromatic</span></span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">hue2rgb</span>(<span class="params">p, q, t</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span>(t &lt; <span class="number">0</span>) t += <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span>(t &gt; <span class="number">1</span>) t -= <span class="number">1</span></span><br><span class="line"><span class="keyword">if</span>(t &lt; <span class="number">1</span>/<span class="number">6</span>) <span class="keyword">return</span> p + (q - p) * <span class="number">6</span> * t</span><br><span class="line"><span class="keyword">if</span>(t &lt; <span class="number">1</span>/<span class="number">2</span>) <span class="keyword">return</span> q</span><br><span class="line"><span class="keyword">if</span>(t &lt; <span class="number">2</span>/<span class="number">3</span>) <span class="keyword">return</span> p + (q - p) * (<span class="number">2</span>/<span class="number">3</span> - t) * <span class="number">6</span></span><br><span class="line"><span class="keyword">return</span> p</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> q = l &lt; <span class="number">0.5</span> ? l * (<span class="number">1</span> + s) : l + s - l * s</span><br><span class="line"><span class="keyword">var</span> p = <span class="number">2</span> * l - q</span><br><span class="line">r = hue2rgb(p, q, n + <span class="number">1</span>/<span class="number">3</span>)</span><br><span class="line">g = hue2rgb(p, q, n)</span><br><span class="line">b = hue2rgb(p, q, n - <span class="number">1</span>/<span class="number">3</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> Jimp.rgbaToInt(</span><br><span class="line"><span class="built_in">Math</span>.round(r * <span class="number">255</span>),</span><br><span class="line"><span class="built_in">Math</span>.round(g * <span class="number">255</span>),</span><br><span class="line"><span class="built_in">Math</span>.round(b * <span class="number">255</span>),</span><br><span class="line"><span class="number">255</span></span><br><span class="line">)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Of course, this is just one example of functions that can turn speed into color. You can design more original ones if you wish.</p>
<p>###Smooth iter<br><a href="http://blog.miskcoo.com/2016/10/mandelbrot-set" target="_blank" rel="noopener">http://blog.miskcoo.com/2016/10/mandelbrot-set</a></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="YolandaWEI" />
          <p class="site-author-name" itemprop="name">YolandaWEI</p>
           
              <p class="site-description motion-element" itemprop="description">personal blog</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">1</span>
                <span class="site-state-item-name">categories</span>
              
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">tags</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">YolandaWEI</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  





  

  

  

  

  

  

</body>
</html>
